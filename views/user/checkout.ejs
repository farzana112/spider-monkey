<head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
<link rel="stylesheet" href="@sweetalert2/themes/dark/dark.css">
<script src="sweetalert2/dist/sweetalert2.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


</head>

<div class="customer-zone mb-20">
  <p class="cart-page-title">Have a coupon? <a class="checkout-click3" href="#">Click here to enter your code</a></p>
  <div>
  <form id="coupon-form" action="/userCouponPost" method="POST">
  <!-- <div class="checkout-login-info3"> -->
      
          <input name ="couponCode" type="text" placeholder="Coupon code" style="width:50%; height:auto;" required>
          <button style="background-color: rgba(243, 166, 22, 0.687);" type="submit"  >Apply Coupon</button  >
          <div id="errormsg"></div>
      </form>
  </div>
</div>


<div class="container">
 
  <div class="checkout-wrap pt-30">
    <form action="/checkout" method="post" id="checkout">
    <div class="row">
      <div class="col-lg-7">
        <div class="billing-info-wrap">
          <h3>Billing Details</h3>
          <div class="row">
            
            <div class="col-lg-6 col-md-6">
              <div class="billing-info mb-20">
                <label
                  ><strong><%=address.name%></strong>
                  
                  </label
                >
                
              </div>
            </div>
            <div class="col-lg-12">
              
            </div>
            <div class="col-lg-12">
              <div class="billing-select select-style mb-20">
                <label
                  ><%=address.contactNumber%>
                 
                  </label
                >
                
              </div>
            </div>
            <div class="col-lg-12">
              <div class="billing-info mb-20">
                <%=address.city%>
                
              </div>
            </div>
            <div class="col-lg-12">
              <div class="billing-info mb-20">
                <label
                  ><%=address.state%>
                 
                  </label
                >
                
              </div>
            </div>
           
            <div class="col-lg-12 col-md-12">
              <div class="billing-info mb-20">
                <label
                  ><%=address.pincode%>
                  
                  </label
                >

              </div>
            </div>
           
          </div>
          
          
        </div>
      </div>
      <div class="col-lg-4">
        <div class="your-order-area">
          <h3>Your order</h3>
          <div class="your-order-wrap gray-bg-4">
            <div class="your-order-info-wrap">
              <div class="your-order-info">
                <ul>
                  <li>Product <span>Total</span></li>
                </ul>
              </div>
              <% for (let i = 0; i < cartItems.length; i++) { %>
              <div class="your-order-middle">
                
                <ul>
                  <li><%=cartItems[i].itemName%> <span><%=cartItems[i].quantity%> </span></span></li>
                  
                </ul>
              </div>
              <% } %>
              <div class="your-order-info order-subtotal">
                <ul>
                  
                </ul>
              </div>
              <div class="your-order-info order-shipping">
                
              </div>
              <div class="your-order-info order-total">
                <ul>
                  <li >Total <span id="totalTag"><%=totalPrice.toLocaleString('en-IN', { style: 'currency', currency: 'INR' })%></span></li>
                  <li > <span id="discountTag"></span></li>
                </ul>
              </div>
            </div>


            
            <div class="payment-method">
              
              
              <div class="pay-top sin-payment">
                <input
                  id="payment-method-3"
                  class="input-radio"
                  type="radio"
                  value="COD"
                  name="payment-method"
                />
                <label for="payment-method-3">COD </label>
                
              </div>

              <div class="pay-top sin-payment sin-payment-3">
                <input id="payment-method-4" class="input-radio" type="radio" value="RazorPay" name="payment-method">
                <label for="payment-method-4">RazorPay <img alt="" src="assets/images/icon-img/payment.png"></label>
                <div class="payment-box payment_method_bacs">
                    <p>Make your payment directly into our bank account. Please use your Order ID as the payment reference.</p>
                </div>
            </div>
             
            </div>
          
          </div>
          <div class="Place-order btn-hover">
            <a href="#"
              onclick="document.getElementById('checkout').submit();" >
              Place Order

            </a>
          </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
$('#coupon-form').submit(function(event) {
         // Prevent the default form submission
         event.preventDefault();
     
         // Get the form data
         var formData = $('#coupon-form').serialize();
     
         // Make the AJAX request
         $.ajax({
           type: 'Post',
           url: '/userCouponPost',
           data: formData,
           dataType:'json',
           success: function(response) {
            console.log("in ajax success");
            if(response.expiry==true)
              {
                let  error = document.getElementById("errormsg");
                error.textContent = "Coupon Expired";
              }
              else if(response.exist==true)
              {
                console.log("already udedd -from ajax");
                let  error = document.getElementById("errormsg");
                error.textContent = "Already used";
               
              }
              else if(response.totallow==true)
              {
                          
                let  error = document.getElementById("errormsg");
                error.textContent = "Minimum total purchase amount should be $"+response.minAmount;
              }
              else{
                
                let Total = document.getElementById("totalTag");
               
                Total.textContent = "₹"+response.discountedTotal;
                discountTag.textContent= "₹"+response.discountAmount;
              
                const jsConfetti = new JSConfetti()

                 jsConfetti.addConfetti();
    
                swal("Congrats!!", "You saved: ₹"+response.discountAmount, "success");

               
           }
        },
           error: function(xhr, status, error) {
            console.log("error from ajax",error);
           }
         });
       });
     
           

            
          
         
</script>